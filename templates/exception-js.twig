{% autoescape 'html_attr' %}
    {% for js in resources.js %}
        <script
                type="text/javascript"
                src="{{ js.link }}"
                integrity="{{ js.integrity }}"
                crossorigin="anonymous"
        ></script>
    {% endfor %}
{% endautoescape %}

<script type="text/javascript">
    (function ($, w) {
        if (!w.localStorage) {
            return;
        }

        $(function () {
            var $btn = $('#btn-night-mode');
            var $body = $('body');
            var SETTINGS_NAME = '__awesomite_error_dumper_night_mode_enabled';
            var NIGHT_MODE_CLASS = 'night-mode';

            var isEnabledNightMode = function () {
                if (null === w.localStorage.getItem(SETTINGS_NAME)) {
                    return false;
                }

                return '1' === w.localStorage.getItem(SETTINGS_NAME);
            };

            var updateState = function () {
                isEnabledNightMode()
                    ? $body.addClass(NIGHT_MODE_CLASS)
                    : $body.removeClass(NIGHT_MODE_CLASS);
            };

            var toggleSettings = function () {
                w.localStorage.setItem(
                    SETTINGS_NAME,
                    isEnabledNightMode() ? '0' : '1'
                );
            };

            $btn.click(function (e) {
                e.preventDefault();
                toggleSettings();
                updateState();
            });

            updateState();
        });
    })(jQuery, window);
</script>
